# STIG ID: [WN10-00-000145](https://stigaview.com/products/win10/v2r8/WN10-00-000145/)

## Vulnerability Discussion

Attackers are constantly looking for vulnerabilities in systems and applications. Data Execution Prevention (DEP) prevents harmful code from running in protected memory locations reserved for Windows and other programs.
Check

## Compliance Check
Verify the DEP configuration.
Open a command prompt (cmd.exe) or PowerShell with elevated privileges (Run as administrator).
Enter "BCDEdit /enum {current}". (If using PowerShell "{current}" must be enclosed in quotes.)
If the value for "nx" is not "OptOut", this is a finding.
(The more restrictive configuration of "AlwaysOn" would not be a finding.)

## Remediation
Configure DEP to at least OptOut.

Note: Suspend BitLocker before making changes to the DEP configuration.

Open a command prompt (cmd.exe) or PowerShell with elevated privileges (Run as administrator).
Enter "BCDEDIT /set {current} nx OptOut". (If using PowerShell "{current}" must be enclosed in quotes.)
"AlwaysOn", a more restrictive selection, is also valid but does not allow applications that do not function properly to be opted out of DEP.

Opted out exceptions can be configured in the "System Properties".

Open "System" in Control Panel.
Select "Advanced system settings".
Click "Settings" in the "Performance" section.
Select the "Data Execution Prevention" tab.
Applications that are opted out are configured in the window below the selection "Turn on DEP for all programs and services except those I select:".

## Powershell Remediation Script
```
# Check for administrative privileges
if (-not ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] "Administrator")) {
    Write-Error "This script requires administrative privileges. Please run PowerShell as an administrator."
    exit
}

# Function to check DEP configuration
function Check-DEP {
    Write-Output "Checking DEP configuration..."
    $DEPStatus = bcdedit /enum '{current}' | Select-String -Pattern "nx\s+\S+"
    if ($DEPStatus -match "nx\s+OptOut") {
        Write-Output "DEP is configured as OptOut. No changes needed."
    } elseif ($DEPStatus -match "nx\s+AlwaysOn") {
        Write-Output "DEP is configured as AlwaysOn. This is acceptable and more restrictive."
    } else {
        Write-Output "DEP is not configured as OptOut or AlwaysOn. This is a finding."
    }
}

# Function to configure DEP to OptOut
function Configure-DEP {
    Write-Output "Configuring DEP to OptOut..."
    try {
        bcdedit /set '{current}' nx OptOut
        Write-Output "DEP successfully configured to OptOut. Restart the system for changes to take effect."
    } catch {
        Write-Error "Failed to configure DEP. Error: $_"
    }
}

# Main script logic
Check-DEP

Write-Output "Do you want to configure DEP to OptOut? (Y/N)"
$UserInput = Read-Host

if ($UserInput -match "^[Yy]$") {
    Configure-DEP
} else {
    Write-Output "No changes made to DEP configuration."
}


Write-Output "Enforcing Group Policy update..."
gpupdate /force
```
