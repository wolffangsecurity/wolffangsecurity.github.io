# STIG ID: [WN10-00-000031](https://stigaview.com/products/win10/v2r8/WN10-00-000031/)

## Vulnerability Discussion

If data at rest is unencrypted, it is vulnerable to disclosure. Even if the operating system enforces permissions on data access, an adversary can remove non-volatile memory and read it directly, thereby circumventing operating system controls. Encrypting the data ensures that confidentiality is protected even when the operating system is not running. Pre-boot authentication prevents unauthorized users from accessing encrypted drives.
Check

## Compliance Check
If the following registry value does not exist or is not configured as specified, this is a finding.

For virtual desktop implementations (VDIs) in which the virtual desktop instance is deleted or refreshed upon logoff, this is NA.

For Azure Virtual Desktop (AVD) implementations with no data at rest, this is NA.

- Registry Hive: `HKEY_LOCAL_MACHINE`
- Registry Path: `\SOFTWARE\Policies\Microsoft\FVE\`
- Value Name: `UseAdvancedStartup`
- Value Type: `REG_DWORD`
- Value: `0x00000001 (1)`

If one of the following registry values does not exist or is not configured as specified, this is a finding.
- Registry Hive: `HKEY_LOCAL_MACHINE`
- Registry Path: `\SOFTWARE\Policies\Microsoft\FVE\`

- Value Name: `UseTPMPIN`
- Type: `REG_DWORD`
- Value: `0x00000001 (1)`

- Value Name: `UseTPMKeyPIN`
- Type: `REG_DWORD`
- Value: `0x00000001 (1)`

When BitLocker network unlock is used:
- Value Name: `UseTPMPIN`
- Type: `REG_DWORD`
- Value: `0x00000002 (2)`  

- Value Name: `UseTPMKeyPIN`
- Type: `REG_DWORD`
- Value: `0x00000002 (2)`

BitLocker network unlock may be used in conjunction with a BitLocker PIN. Refer to the article at the link below for information about network unlock.

## Remediation
 Configure the policy value for Computer Configuration >> Administrative Templates >> Windows Components >> BitLocker Drive Encryption >> Operating System Drives "Require additional authentication at startup" to "Enabled" with "Configure TPM Startup PIN:" set to "Require startup PIN with TPM" or with "Configure TPM startup key and PIN:" set to "Require startup key and PIN with TPM".

## Powershell Remediation Script
```
# Check for administrative privileges
if (-not ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] "Administrator")) {
    Write-Error "This script requires administrative privileges. Please run PowerShell as an administrator."
    exit
}

# Define the registry path
$RegistryPath = "HKLM:\SOFTWARE\Policies\Microsoft\FVE"

# Define the required registry values and their configurations
$RegistryValues = @{
    "UseAdvancedStartup" = 1;
    "UseTPMPIN" = 1;
    "UseTPMKeyPIN" = 1
}

# Ensure the registry path exists
if (-not (Test-Path $RegistryPath)) {
    Write-Output "Registry path does not exist. Creating path: $RegistryPath"
    New-Item -Path $RegistryPath -Force | Out-Null
}

# Set the required registry values
foreach ($Key in $RegistryValues.Keys) {
    $Value = $RegistryValues[$Key]
    Write-Output "Configuring $Key to $Value..."
    Set-ItemProperty -Path $RegistryPath -Name $Key -Value $Value -Force
}

# Verify the configured registry values
Write-Output "Verifying the configured registry values..."
foreach ($Key in $RegistryValues.Keys) {
    $ExpectedValue = $RegistryValues[$Key]
    $ConfiguredValue = (Get-ItemProperty -Path $RegistryPath -Name $Key -ErrorAction SilentlyContinue).$Key
    if ($ConfiguredValue -eq $ExpectedValue) {
        Write-Output "Verification successful: $Key is set to $ConfiguredValue."
    } else {
        Write-Error "Verification failed: $Key is not set correctly. Current value: $ConfiguredValue."
    }
}

# Force Group Policy update
Write-Output "Enforcing Group Policy update..."
gpupdate /force
```
